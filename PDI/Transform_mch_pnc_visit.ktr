<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>Transform_mch_pnc_visit</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2020/01/23 14:41:25.820</created_date>
    <modified_user>-</modified_user>
    <modified_date>2020/01/23 14:41:25.820</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>mysql_tr</name>
    <server/>
    <type>MYSQL</type>
    <access>JNDI</access>
    <database>mysql_tr</database>
    <port>1521</port>
    <username/>
    <password>Encrypted </password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1521</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>STREAM_RESULTS</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
  </order>
  <step>
    <name>load_tr_mch_pnc_visit</name>
    <type>ExecSQL</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>mysql_tr</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>-- 23. Create mch pnc transformed table

  DROP TABLE IF EXISTS migration_tr.tr_mch_pnc_visit;
  CREATE TABLE migration_tr.tr_mch_pnc_visit as
  select
  pnc.Person_Id,
  pnc.Patient_clinic_number,
  pnc.Encounter_Date,
  pnc.Encounter_ID,
  pnc.PNC_Register_number,
  pnc.PNC_VisitNumber,
  pnc.Delivery_Date,
  (case pnc.Mode_Of_Delivery
     when "Caesarean section" then 1171
     when "SVD" then 1170
     when "Unknown" then 1067  else NULL end)as  Mode_Of_Delivery,
  pnc.Place_Of_delivery,
  pnc.Temperature,
  pnc.Pulse_rate,
  pnc.Systolic_bp,
  pnc.Diastolic_bp,
  pnc.Respiratory_rate,
  pnc.Oxygen_saturation,
  pnc.Weight,
  pnc.Height,
  pnc.BMI,
  pnc.Muac,
  pnc.General_Condition,
  (case pnc.Pallor
     when "Pallor" then 1065
     when "No" then 1066
     when "Unknown" then 1067  else NULL end)as  Pallor,
  (case pnc.Breast_Examination
     when "Mastitis" then 115915
     when "Engorged" then 127522
     when "Cracked" then 143242
     when "Normal" then 1115
     when "Unknown" then 1067  else NULL end)as  Breast_Examination,
  (case pnc.PPH
     when "PostPartumHaemorrhage" then 1065
     when "No" then 1066
     when "Unknown" then 1067  else NULL end)as  PPH,
  (case pnc.CS_Scar
     when "Infected" then 156794
     when "Gaping" then 145776
     when "Bleeding" then 145776
     when "Normal" then 162129
     when "N/A" then 1175
     when "Unknown" then 1067  else NULL end)as  CS_Scar,
  pnc.Haemoglobin,
 (case pnc.Involution_Of_Uterus
     when "Not Contracted" then 162111
     when "Contracted" then 123427
     when "Other" then 5622
     when "Other (Specify)" then 5622
     when "N/A" then 1175
     when "Unknown" then 1067  else NULL end)as  Involution_Of_Uterus,
 (case pnc.Condition_Of_Episiotomy
     when "Healed" then 159843
     when "Infected" then 113919
     when "Gaping" then 159841
     when "Repaired" then 159842
     when "N/A" then 1175
     when "Unknown" then 1067  else NULL end)as  Condition_Of_Episiotomy,
 (case pnc.Lochia
     when "Excessive" then 159845
     when "Foul smelling" then 159846
     when "Normal" then 159721
     when "Unknown" then 1067  else NULL end)as  Lochia,
(case pnc.Counselling_On_Infant_Feeding
     when "Yes" then 1065
     when "No" then 1066
     when "N/A" then 1175
     when "Unknown" then 1067  else NULL end)as  Counselling_On_Infant_Feeding,
  pnc.Counselling_On_FamilyPlanning,
  pnc.Delivery_outcome,
 (case pnc.Baby_Condition
     when "Unwell" then 162132
     when "Well" then 1855
     when "Unknown" then 1067  else NULL end)as  Baby_Condition,
  pnc.Feeding_Method,
  pnc.Umblical_Cord,
  pnc.Immunization_Started,
    (case pnc.Test_1_Kit_Name
     when "First Response" then 164961
     when "Determine" then 164960
     when "Other" then 1175  else '' end) as Test_1_Kit_Name,
    pnc.Test_1_kit_lot_no,
    pnc.Test_1_kit_expiry,
    (case pnc.Test_1_Result
     when "Positive" then 703
     when "Negative" then 664
     when "Inconclusive" then 1138  else '' end)as  Test_1_Result,
    (case pnc.Test_2_Kit_Name
     when "First Response" then 164961
     when "Determine" then 164960
     when "Other" then 1175  else '' end)as  Test_2_Kit_Name,
    pnc.Test_2_kit_lot_no,
    pnc.Test_2_kit_expiry,
    (case pnc.Test_2_Result
     when "Positive" then 703
     when "Negative" then 664
     when "Inconclusive" then 1138  else '' end)as  Test_2_Result,
    (case  pnc.Final_test_result
     when "Positive" then 703
     when "Negative" then 664
     when "Inconclusive" then 1138  else '' end)as  Final_test_result,
    (case pnc.Patient_given_result
     when "Yes" then 1065
     when "No" then 1066  else '' end)as Patient_given_result,
    (case pnc.Partner_hiv_tested
     when "Yes" then 1065
     when "No" then 1066  when "N/A" then 1175 else '' end) as  Partner_hiv_tested,
    (case pnc.Partner_hiv_status
     when "Negative" then 664
     when  "Positive" then 703
     when "Unknown" then 1067 else '' end) as Partner_hiv_status,
    (case pnc.Prophylaxis_given
     when "No" then 1066
     when "Yes" then 1065
     when "Unknown" then 1067  else '' end)as  Prophylaxis_given,
    (case pnc.Baby_azt_dispensed
     when "No" then 1066
     when "Yes" then 1065
     when "N/A" then 1175  else '' end)as  Baby_azt_dispensed,
    (case pnc.Baby_nvp_dispensed
     when "No" then 1066
     when "Yes" then 1065
     when "N/A" then 1175  else '' end)as  Baby_nvp_dispensed,
  (case pnc.Pnc_exercises
     when "No" then 1066
     when "Yes" then 1065
     when "N/A" then 1175  else '' end)as  Pnc_exercises,
  pnc.Maternal_condition,
 (case pnc.Iron_supplementation
     when "No" then 1066
     when "Yes" then 1065
     when "N/A" then 1175  else '' end)as  Iron_supplementation,
    (case pnc.Cacx_screening
     when "No" then 1066
     when "yes" then 1066
     when "Confirmed" then 703
     when "Suspected" then 159393
     when "N/A" then 1175
     when "Normal" then 664
     when "Never" then 1090
     when "Not Done" then 1118 end)as Cacx_screening,
    (case pnc.Cacx_screening_method
     when "Pap Smear" then 885
     when "VIA" then 162816
     when "VIA/VILI" then 162816
     when "VILI" then 164977
     when "Other" then 5622
     when "Not Done" then 1118
     when "Not Applicable" then 1175 end)as Cacx_screening_method,  
  (case pnc.Fistula_screening
     when "Vesicovaginal Fistula" then 49
     when "Rectovaginal Fistula" then 127847
     when "Not done" then 1118
     when "N/A" then 1175  else NULL end) as  Fistula_screening,
  (case pnc.On_FP
     when "No" then 1066
     when "Yes" then 1065
     when "Unknown" then 1067  else NULL end)as  On_FP,
  (case pnc.FP_Method
     when "Vasectomy" then 1489
     when "Tubal Ligation /Female Sterilization" then 1472
     when "Fertility Awareness Method" then 5277
     when "Diaphragm/Cervical Cap" then 5278
     when "Lactational Amenorrhea Method" then 136163
     when "Intra Uterine Device" then 5275
     when "Implant" then 1359
     when "Injectable" then 5279
     when "Oral Contraceptive Pills" then 780
     when "Emergency Contraceptive Pills" then 160570
     when "Condoms" then 190
     when "Unknown" then 1067  else '' end)as  FP_Method,  
 (case pnc.Referred_From
     when "Another Health Facility" then 164407
     when "Current Health Facility" then 163266
     when "Community Unit" then 160543
     when "Unknown" then 1067  else NULL end)as  Referred_From,
 (case pnc.Referred_To
     when "Another Health Facility" then 164407
     when "Current Health Facility" then 163266
     when "Community Unit" then 160543
     when "Unknown" then 1067  else NULL end)as  Referred_To,
  pnc.Clinical_notes,
  pnc.Next_Appointment_Date,
  pnc.CreatedBy as Created_by,
  pnc.CreateDate as Create_date                       
  FROM migration_st.st_mch_pnc_visit pnc
      LEFT JOIN migration_tr.tr_demographics dm ON dm.Person_Id = pnc.Person_Id  
      WHERE (pnc.Encounter_Date != "" OR pnc.Encounter_Date IS NOT NULL)
      GROUP BY pnc.Person_Id, pnc.Encounter_Date;</sql>
    <set_params>N</set_params>
    <insert_field/>
    <update_field/>
    <delete_field/>
    <read_field/>
    <arguments>
    </arguments>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>176</xloc>
      <yloc>48</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
