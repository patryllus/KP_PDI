<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>Transform_kp_clinical_visits</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2020/11/04 16:02:18.948</created_date>
    <modified_user>-</modified_user>
    <modified_date>2020/11/04 16:02:18.948</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>clinical_visits_conn</name>
    <server/>
    <type>MYSQL</type>
    <access>JNDI</access>
    <database>mysql_tr</database>
    <port>1521</port>
    <username/>
    <password>Encrypted </password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1521</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>STREAM_RESULTS</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
  </order>
  <step>
    <name>load_tr_kp_clinical_visits</name>
    <type>ExecSQL</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>clinical_visits_conn</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>--  KP clinical visits
DROP TABLE IF EXISTS migration_tr.tr_kp_clinical_visits;
CREATE TABLE migration_tr.tr_kp_clinical_visits as
 select
 Person_Id,
 Patient_clinic_number,
 Encounter_Date,
 Encounter_ID,
 implementing_partner,
 (case Type_of_visit
   when "Medical Review"  then 164142
   when "ARV Pickup" then 164142
   when "PEP" then 162080          -- initial
   when "TB Screening" then 162080   -- initial
   when "Enrolment" then 162080   -- initial
   when "PrEP Month one Refill" then 162080   -- initial
   when "VCT" then 162080   -- initial
   when "ARV Initiation" then 162080   -- initial
   when "Care Enrolment" then 162080   -- initial
   when "PrEP Initiation" then 162080   -- initial
   when "Condom Break" then 162080   -- initial
   when "Health Education" then 162080   -- initial
   when "CACX Screening" then 162080   -- initial
   when "PrEP Screening (RAST)" then 162080   -- initial
   when "Counseling" then 162080   -- initial
   when "Enhanced Adherence Counselling" then 162080   -- initial
   when "Adherence Counselling I" then 162080   -- initial
   when "Follow Up" then 164142   -- repeat
   when "PrEP-Refill" then 164142   -- repeat
   when "Results" then 164142   -- repeat
   when "Refill - ARV" then 164142   -- repeat
   when "RESPECT-K" then 164142   -- repeat
   when "Sister to Sister" then 164142   -- repeat
   when "Adherence Counselling II" then 164142   -- repeat
   when "Unknown" then 1067 else "" end) as Type_of_visit,
 (case Reason_for_visit
   when "Asymptomatic"  then 5006
   when "Symptomatic" then 1068
   when "Unknown" then 1067 else "" end) as Reason_for_visit,
 Service_delivery_model,
 (case STI_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as STI_screened,
 STI_results,
 (case STI_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as STI_treated,
 (case STI_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as STI_referred,
 STI_remarks,
 (case TB_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as TB_screened,
 (case TB_results
   when "Negative"  then 664
   when "Positive" then 703
   when "Unknown" then 1067 else "" end) as TB_results,
 (case TB_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as TB_treated,
 (case TB_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as TB_referred,
 TB_remarks,
 (case HepatitisB_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as HepatitisB_screened,
 (case HepatitisB_results
   when "Negative"  then 664
   when "Positive" then 703
   when "Unknown" then 1067 else "" end) as HepatitisB_results,
 (case HepatitisB_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Vaccinated" then 782
   when "Unknown" then 1067 else "" end) as HepatitisB_treated,
 (case HepatitisB_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as HepatitisB_referred,
 HepatitisB_remarks,
 (case HepatitisC_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as HepatitisC_screened,
  (case HepatitisC_results
   when "Negative"  then 664
   when "Positive" then 703
   when "Unknown" then 1067 else "" end) as HepatitisC_results,
  (case HepatitisC_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as HepatitisC_treated,
  (case HepatitisC_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as HepatitisC_referred,
  HepatitisC_remarks,
 (case OverdoseMGT_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as OverdoseMGT_screened,
 (case OverdoseMGT_results
   when "Negative"  then 664
   when "Positive" then 703
   when "Unknown" then 1067 else "" end) as OverdoseMGT_results,
 (case OverdoseMGT_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as OverdoseMGT_treated,
 (case OverdoseMGT_received_naloxone
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as OverdoseMGT_received_naloxone,
 (case OverdoseMGT_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as OverdoseMGT_referred,
 OverdoseMGT_remarks,
  (case Abscess_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Abscess_screened,
  (case Abscess_results
   when "Negative"  then 664
   when "Positive" then 703
   when "Unknown" then 1067 else "" end) as Abscess_results,
  (case Abscess_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Abscess_treated,
  (case Abscess_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Abscess_referred,
 Abscess_remarks,
  (case Alcohol_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Alcohol_screened,
  (case Alcohol_results
   when "Negative"  then 664
   when "Positive" then 703
   when "Unknown" then 1067 else "" end) as Alcohol_results,
  (case Alcohol_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Alcohol_treated,
  (case Alcohol_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Alcohol_referred,
 Alcohol_remarks,
  (case Cervical_Cancer_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Cervical_Cancer_screened,
  (case Cervical_Cancer_results
   when "Negative"  then 664
   when "Positive" then 703
   when "Unknown" then 1067 else "" end) as Cervical_Cancer_results,
  (case Cervical_Cancer_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Cervical_Cancer_treated,
  (case Cervical_Cancer_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Cervical_Cancer_referred,
  Cervical_Cancer_remarks,
  (case PrEP_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as PrEP_screened,
  (case PrEP_results
   when "Eligible"  then 165087
   when "Not eligible" then 165078
   when "Unknown" then 1067 else "" end) as PrEP_results,
  (case PrEP_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as PrEP_treated,
  (case PrEP_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as PrEP_referred,
 PrEP_remarks,
  (case Violence_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Violence_screened,
  (case Violence_results
   when "Harrasment"  then 165206
   when "Assault/Physical abuse" then 121387
   when "Illegal arrest" then 165207
   when "Verbal Abuse" then 123007
   when "Rape/Sexual assault" then 127910
   when "Discrimination" then 126312
   when "Unknown" then 1067 else "" end) as Violence_results,
  (case Violence_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Violence_treated,
  (case Violence_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Violence_referred,
 Violence_remarks,
 (case Risk_counselling_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Risk_counselling_screened,
 (case Risk_counselling_results
   when "Eligible"  then 165087
   when "Not eligible" then 165078
   when "Unknown" then 1067 else "" end) as Risk_counselling_results,
 (case Risk_counselling_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Risk_counselling_treated,
 (case Risk_counselling_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Risk_counselling_referred,
 Risk_counselling_remarks,
 (case Family_planning_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Family_planning_screened,
 (case Family_planning_results
   when "Eligible"  then 165087
   when "Not Eligible" then 165078
   when "Unknown" then 1067 else "" end) as Family_planning_results,
 (case Family_planning_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "On-going" then 965
   when "Unknown" then 1067 else "" end) as Family_planning_treated,
 Family_planning_givenMethod,
 (case Family_planning_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Family_planning_referred,
 Family_planning_remarks,
(case Mental_health_screened
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Mental_health_screened,
  (case Mental_health_results
   when "Depression unlikely"  then 165212
   when "mild depression"  then 157790
   when "Moderate Major Depression"  then 134017
   when "Moderate Recurrent Major Depression"  then 134011
   when "Severe Depression" then 126627
   when "Unknown" then 1067 else "" end) as Mental_health_results,
  (case Mental_health_treated
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Mental_health_treated,
 (case Mental_health_referred
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Mental_health_referred,
 Mental_health_remarks,
 (case self_reported_status
   when "Negative"  then 664
   when "Positive" then 703
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as self_reported_status,
(case last_HIV_test_results
   when "Universal HTS"  then 165216
   when "Self-testing" then 165217
   when "Never tested"  then 1402
   when "yes" then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as last_HIV_test_results,
 (case Counselled
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Counselled,
 (case Tested
   when "Yes"  then 1065
   when "No" then 1066
   when "Not applicable" then 1175
   when "Unknown" then 1067 else "" end) as Tested,
 (case Frequency_of_test
   when "Initial"  then 162080
   when "Repeat"  then 162081
   when "Yes" then 1065
   when "No" then 1066
   when "Not applicable" then 1175
   when "Unknown" then 1067 else "" end) as Frequency_of_test,
 (case Received_results
   when "Yes"  then 1065
   when "No" then 1066
   when "Not applicable" then 1175
   when "Unknown" then 1067 else "" end) as Received_results,
 (case Testing_results
   when "Negative"  then 664
   when "Positive" then 703
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Testing_results,
 (case Testing_results
   when "Negative"  then 664
   when "Positive" then 703
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as Testing_results_coded,
(case linked_to_ART
   when "Yes"  then 1
   when "No" then 2  else "" end) as Linked_to_ART,
(case linked_to_ART
   when "Yes"  then 1
   when "No" then 2  else "" end) as linked_to_ART_coded,
 Facility,
 (case HIV_self_test
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as HIV_self_test,
 Number_of_test_kits_given,
 Self_Tested_for_HIV,
 distribution_kits,
 (case self_tested
   when "Yes"  then 1065
   when "No" then 1066
   when "Unknown" then 1067 else "" end) as self_tested,
 Date_conducted,
 (case Confirmatory_test_results
   when "Negative"  then 664
   when "Positive" then 703
   when "Inconclusive"  then 165232
   when "Known positive" then 138571
   when "Not Applicable" then 1118
   when "Unknown" then 1067 else "" end) as Confirmatory_test_results,
  (case Facility_confirmatory_test_done
   when "Off-site"  then 165236
   when "On-site" then 165236
   when "Unknown" then 1067 else "" end) as Facility_confirmatory_test_done,
 Councillor_name,
 offsite_confirmatory_facility,
Facility_linked_to,
Date_linked,
(case Facility_of_HIV_care
   when "Provided here"  then 163266
   when "Provided elsewhere" then 162723
   when "N/A" then 1175 else "" end) as Facility_of_HIV_care,
other_hiv_care_facility,
 (case Initiated_on_ARV_this_month
   when "Yes"  then 1065
   when "No" then 1066
   when "Not applicable" then 1175 else "" end) as Initiated_on_ARV_this_month,
(case Active_on_ART
  when "Yes"  then 1065
  when "No" then 1066
  when "Not applicable" then 1175 else "" end) as Active_on_ART,
(case Eligible_for_VL
   when "Yes"  then 1065
   when "No" then 1066
   when "Not applicable" then 1175 else "" end) as Eligible_for_VL,
(case VL_test_done
   when "Yes"  then 1065
   when "No" then 1066
   when "Not applicable" then 1175 else "" end) as VL_test_done,
(case VL_test_results
   when "Suppressed"  then 165244
   when "Not Suppressed" then 165245
   when "Results not yet received" then 164369
   when "Not applicable" then 1175 else "" end) as VL_test_results,
 (case received_vl_results
   when "Yes"  then 1065
   when "No" then 1066
   when "Not applicable" then 1175 else "" end) as received_vl_results,
 (case Condom_education
   when "Yes"  then 1065
   when "No" then 1066
   when "Not applicable" then 1175 else "" end) as Condom_education,
 (case Post_abortal_care_provided
   when "Yes"  then 1065
   when "No" then 1066
   when "Not applicable" then 1175 else "" end) as Post_abortal_care_provided,
Referral,
 (case Link_to_psychosocial_support
   when "Yes"  then 1065
   when "No" then 1066
   when "Not applicable" then 1175 else "" end) as Link_to_psychosocial_support,
 No_of_male_condoms,
 No_of_female_condoms,
 No_of_lubes,
 No_of_syringes,
(case PEP
   when "Yes"  then 1065
   when "No" then 1066
   when "Not applicable" then 1175 else "" end) as PEP,
 (case Type_of_exposure
   when "Rape"  then 127910
   when "Condom burst" then 165059
   when "Other" then 5622
   when "Not applicable" then 1175 else "" end) as Type_of_exposure,
 Clinical_notes,
 Clinician_name,
 Signoff_date,
 Next_visit_date,
 Create_date,
 1 AS Created_by
 FROM migration_st.st_kp_clinical_visits
 -- INNER JOIN migration_tr.tr_demographics dm ON dm.Person_Id = sp.Person_Id
 WHERE (Encounter_Date != "" OR Encounter_Date IS NOT NULL)
 GROUP BY Person_Id, Encounter_Date;

</sql>
    <set_params>N</set_params>
    <insert_field/>
    <update_field/>
    <delete_field/>
    <read_field/>
    <arguments>
    </arguments>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>283</xloc>
      <yloc>72</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
